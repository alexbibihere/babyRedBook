# ğŸ” ä½¿ç”¨ç™»å½•ä¼šè¯é‡‡é›†å°çº¢ä¹¦ç¬”è®°

## ğŸ“‹ åŠŸèƒ½è¯´æ˜

è¿™ä¸ªæ–¹æ¡ˆè§£å†³äº†ä¹‹å‰é‡åˆ°çš„"ç”¨æˆ·åè®®"å’Œè™šå‡å†…å®¹é—®é¢˜ã€‚é€šè¿‡åœ¨å°çº¢ä¹¦å·²ç™»å½•çŠ¶æ€ä¸‹é‡‡é›†,å¯ä»¥è·å–ç¬”è®°çš„çœŸå®å†…å®¹ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: é¦–æ¬¡ç™»å½•ä¿å­˜ä¼šè¯

è¿è¡Œç™»å½•è„šæœ¬:

```bash
npm run login
```

è¿™ä¸ªè„šæœ¬ä¼š:
1. âœ… æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨çª—å£
2. âœ… è‡ªåŠ¨è®¿é—®å°çº¢ä¹¦ç™»å½•é¡µé¢
3. âœ… ç­‰å¾…ä½ æ‰‹åŠ¨å®Œæˆç™»å½•(æ‰‹æœºå·æˆ–æ‰«ç )
4. âœ… è‡ªåŠ¨æ£€æµ‹ç™»å½•æˆåŠŸ
5. âœ… ä¿å­˜ Cookie åˆ° `data/cookies.json`
6. âœ… ä¿å­˜æµè§ˆå™¨ä¼šè¯åˆ° `.puppeteer-data/` æ–‡ä»¶å¤¹

**ç™»å½•å,æµè§ˆå™¨ä¼šè‡ªåŠ¨å…³é—­,Cookie å·²ä¿å­˜ã€‚**

---

### æ­¥éª¤ 2: æ£€æŸ¥ç™»å½•çŠ¶æ€

æŸ¥çœ‹å·²ä¿å­˜çš„ Cookie:

```bash
npm run login:check
```

ä¼šæ˜¾ç¤º:
- âœ… Cookie æ•°é‡
- âœ… å…³é”® Cookie (a1, web_session, webId ç­‰)
- âœ… Cookie å­—ç¬¦ä¸²(å¯ç”¨äº HTTP è¯·æ±‚)

---

### æ­¥éª¤ 3: ä½¿ç”¨ç™»å½•ä¼šè¯é‡‡é›†ç¬”è®°

é‡‡é›†æ‰€æœ‰ç¬”è®°çš„çœŸå®å†…å®¹:

```bash
npm run extract:login
```

è¿™ä¸ªè„šæœ¬ä¼š:
1. âœ… åŠ è½½ä¿å­˜çš„ Cookie
2. âœ… ä½¿ç”¨å·²ç™»å½•ä¼šè¯è®¿é—®ç¬”è®°
3. âœ… æå–çœŸå®å†…å®¹(ä¸æ˜¯"ç”¨æˆ·åè®®")
4. âœ… è‡ªåŠ¨æ£€æµ‹è™šå‡å†…å®¹
5. âœ… ä¿å­˜åˆ° `data/notes-with-login.json`
6. âœ… å®æ—¶æ˜¾ç¤ºè¿›åº¦

---

## ğŸ“‚ æ–‡ä»¶è¯´æ˜

### æ–°å¢æ–‡ä»¶

| æ–‡ä»¶ | ä½œç”¨ |
|------|------|
| [crawler/login-save-session.js](crawler/login-save-session.js) | è‡ªåŠ¨ç™»å½•å¹¶ä¿å­˜ä¼šè¯ |
| [crawler/load-cookies.js](crawler/load-cookies.js) | Cookie ç®¡ç†å·¥å…· |
| [crawler/extract-with-login.js](crawler/extract-with-login.js) | ä½¿ç”¨ç™»å½•ä¼šè¯é‡‡é›†ç¬”è®° |
| `data/cookies.json` | ä¿å­˜çš„ Cookie (è‡ªåŠ¨ç”Ÿæˆ) |
| `.puppeteer-data/` | æµè§ˆå™¨ç”¨æˆ·æ•°æ® (è‡ªåŠ¨ç”Ÿæˆ) |

---

## ğŸ”‘ Cookie è¯¦è§£

### å…³é”® Cookie

| åç§° | ä½œç”¨ | å¿…éœ€ |
|------|------|------|
| `a1` | ç”¨æˆ·è®¤è¯ä»¤ç‰Œ | âœ… å¿…éœ€ |
| `web_session` | ä¼šè¯ID | âœ… å¿…éœ€ |
| `webId` | ç”¨æˆ·æ ‡è¯† | âœ… å¿…éœ€ |
| `webBuild` | ç‰ˆæœ¬ä¿¡æ¯ | âš ï¸ å»ºè®® |

### Cookie æœ‰æ•ˆæœŸ

- **a1**: é€šå¸¸ 30 å¤©
- **web_session**: å‡ å¤©åˆ°å‡ å‘¨
- **å»ºè®®**: æ¯å‘¨é‡æ–°ç™»å½•ä¸€æ¬¡

---

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: ä¸€æ¬¡æ€§é‡‡é›†

```bash
# 1. ç™»å½•ä¿å­˜ä¼šè¯
npm run login

# 2. é‡‡é›†ç¬”è®°
npm run extract:login

# 3. æŸ¥çœ‹ç»“æœ
cat data/notes-with-login.json
```

### åœºæ™¯ 2: å¤šæ¬¡é‡‡é›†(æ— éœ€é‡å¤ç™»å½•)

```bash
# é¦–æ¬¡ç™»å½•å,Cookie å·²ä¿å­˜
# åç»­é‡‡é›†ç›´æ¥ä½¿ç”¨,æ— éœ€é‡æ–°ç™»å½•

npm run extract:login  # ç¬¬1æ¬¡
npm run extract:login  # ç¬¬2æ¬¡ (æ— éœ€ç™»å½•)
npm run extract:login  # ç¬¬3æ¬¡ (æ— éœ€ç™»å½•)
```

### åœºæ™¯ 3: Cookie å¤±æ•ˆåé‡æ–°ç™»å½•

å¦‚æœé‡‡é›†æ—¶å‡ºç°æœªç™»å½•æç¤º:

```bash
# é‡æ–°ç™»å½•
npm run login

# ç»§ç»­é‡‡é›†
npm run extract:login
```

---

## ğŸ› ï¸ é«˜çº§ç”¨æ³•

### åœ¨ä»£ç ä¸­ä½¿ç”¨ Cookie

```javascript
import { createBrowserWithSession } from './crawler/load-cookies.js';

// åˆ›å»ºå¸¦ç™»å½•ä¼šè¯çš„æµè§ˆå™¨
const { browser, page } = await createBrowserWithSession({
    headless: false
});

// ç›´æ¥è®¿é—®é¡µé¢,å·²ç™»å½•çŠ¶æ€
await page.goto('https://www.xiaohongshu.com/explore/...');

// æå–æ•°æ®...
```

### ä½¿ç”¨ Cookie å­—ç¬¦ä¸²

```javascript
import { getCookieString } from './crawler/load-cookies.js';

// è·å– Cookie å­—ç¬¦ä¸²
const cookieString = getCookieString();

// ç”¨äº HTTP è¯·æ±‚
import axios from 'axios';

const response = await axios.get('https://www.xiaohongshu.com/api/...', {
    headers: {
        'Cookie': cookieString
    }
});
```

### æ‰‹åŠ¨åŠ è½½ Cookie åˆ°é¡µé¢

```javascript
import puppeteer from 'puppeteer';
import { loadCookies } from './crawler/load-cookies.js';

const browser = await puppeteer.launch();
const page = await browser.newPage();

// åŠ è½½ Cookie
await loadCookies(page);

// ç°åœ¨é¡µé¢å·²ç™»å½•çŠ¶æ€
await page.goto('https://www.xiaohongshu.com');
```

---

## ğŸ“Š æ•°æ®å¯¹æ¯”

### æœªç™»å½•çŠ¶æ€é‡‡é›†

```json
{
  "title": "ç”Ÿäº§å1â€”3å¤©ï¼Œè€å…¬å¦‚ä½•ç…§é¡¾å­•å¦‡",
  "content": "ã€Šç”¨æˆ·åè®®ã€‹ã€Šéšç§æ”¿ç­–ã€‹æ²ªICPå¤‡13030189å·...",
  "isSpam": true
}
```

### ä½¿ç”¨ç™»å½•ä¼šè¯é‡‡é›†

```json
{
  "title": "ç”Ÿäº§å1â€”3å¤©ï¼Œè€å…¬å¦‚ä½•ç…§é¡¾å­•å¦‡",
  "content": "ç”Ÿäº§åçš„å‰å‡ å¤©æ˜¯æœ€éš¾ç†¬çš„...[çœŸå®å†…å®¹]",
  "isSpam": false,
  "hasValidContent": true
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Cookie å®‰å…¨

- âš ï¸ **ä¸è¦**å°† `data/cookies.json` æäº¤åˆ° Git
- âš ï¸ Cookie åŒ…å«ä½ çš„ç™»å½•å‡­è¯,æ³„éœ²åä»–äººå¯è®¿é—®ä½ çš„è´¦å·
- âœ… å»ºè®®åœ¨ `.gitignore` ä¸­æ·»åŠ :

```gitignore
data/cookies.json
.puppeteer-data/
```

### 2. ç™»å½•å¤±æ•ˆ

å¦‚æœå‡ºç°ä»¥ä¸‹æƒ…å†µ,è¯´æ˜ Cookie å¤±æ•ˆ:
- é‡‡é›†çš„å†…å®¹åˆæ˜¯"ç”¨æˆ·åè®®"
- æç¤º"è¯·å…ˆç™»å½•"
- è¿”å› 401 æˆ– 403 é”™è¯¯

**è§£å†³æ–¹æ³•**: é‡æ–°è¿è¡Œ `npm run login`

### 3. æµè§ˆå™¨çª—å£

ç™»å½•è„šæœ¬ä¼šæ˜¾ç¤ºæµè§ˆå™¨çª—å£,**ä¸è¦æ‰‹åŠ¨å…³é—­**:
- è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹ç™»å½•çŠ¶æ€
- ç™»å½•æˆåŠŸåè‡ªåŠ¨å…³é—­æµè§ˆå™¨
- æ‰‹åŠ¨å…³é—­å¯èƒ½å¯¼è‡´ Cookie æœªä¿å­˜

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æ— æ³•æ£€æµ‹åˆ°ç™»å½•çŠ¶æ€

**åŸå› **: ç™»å½•æŒ‰é’®é€‰æ‹©å™¨å¯èƒ½å˜åŒ–

**è§£å†³**:
1. æ‰‹åŠ¨å®Œæˆç™»å½•
2. ç­‰å¾… 10 ç§’
3. è„šæœ¬ä¼šè¶…æ—¶å¹¶å°è¯•ä¿å­˜ Cookie
4. æˆ–åœ¨æµè§ˆå™¨ Console æ‰§è¡Œ: `document.cookie`

### é—®é¢˜ 2: Cookie ä¿å­˜å¤±è´¥

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹ Cookie æ–‡ä»¶
cat data/cookies.json

# æŸ¥çœ‹ Cookie å­—ç¬¦ä¸²
npm run login:check
```

### é—®é¢˜ 3: é‡‡é›†æ—¶æç¤ºæœªç™»å½•

**åŸå› **: Cookie å¤±æ•ˆ

**è§£å†³**:
```bash
npm run login  # é‡æ–°ç™»å½•
```

---

## ğŸ“š ç›¸å…³å‘½ä»¤

```bash
# ç™»å½•ä¿å­˜ä¼šè¯
npm run login

# æ£€æŸ¥ Cookie çŠ¶æ€
npm run login:check

# ä½¿ç”¨ç™»å½•ä¼šè¯é‡‡é›†
npm run extract:login

# é‡‡é›†æ‰€æœ‰ç¬”è®°(æœªç™»å½•)
npm run extract:all

# æŸ¥çœ‹ç¬”è®°åˆ—è¡¨
cat data/notes.json

# æŸ¥çœ‹ Web ç•Œé¢
npm run serve
```

---

## ğŸ¯ å®Œæ•´å·¥ä½œæµç¨‹

```bash
# 1. é¦–æ¬¡:è·å–ç¬”è®°åˆ—è¡¨(åœ¨æµè§ˆå™¨ Console è¿è¡Œ collect-script.js)
#    ä¿å­˜åˆ° data/notes.json

# 2. ç™»å½•ä¿å­˜ä¼šè¯
npm run login

# 3. ä½¿ç”¨ç™»å½•ä¼šè¯é‡‡é›†çœŸå®å†…å®¹
npm run extract:login

# 4. (å¯é€‰) OCR è¯†åˆ«å›¾ç‰‡æ–‡å­—
npm run ocr:all

# 5. ç”Ÿæˆæ–‡æ¡£
npm run doc:full

# 6. å¯åŠ¨ Web æœåŠ¡å™¨æŸ¥çœ‹
npm run serve
```

---

## âœ… ä¼˜åŠ¿æ€»ç»“

ä½¿ç”¨ç™»å½•ä¼šè¯é‡‡é›†çš„å¥½å¤„:

| åŠŸèƒ½ | æœªç™»å½• | å·²ç™»å½• |
|------|--------|--------|
| è·å–çœŸå®å†…å®¹ | âŒ | âœ… |
| é¿å…"ç”¨æˆ·åè®®" | âŒ | âœ… |
| è®¿é—®æ”¶è—/ç‚¹èµ | âŒ | âœ… |
| æŸ¥çœ‹å®Œæ•´ç¬”è®° | âŒ | âœ… |
| è®¿é—®ç”¨æˆ·ä¸»é¡µ | âŒ | âœ… |
| Cookie æœ‰æ•ˆæœŸ | - | 30 å¤© |

---

## ğŸ‰ å¼€å§‹ä½¿ç”¨

```bash
# ç«‹å³å¼€å§‹!
npm run login
```

ç™»å½•æˆåŠŸå,å°±å¯ä»¥é‡‡é›†çœŸå®çš„ç¬”è®°å†…å®¹äº†!
